<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>components/cards/DisplayCard.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
    <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>

    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav class="nav">
    <h2><a href="index.html">Home</a></h2><h3>Namespaces</h3><ul><li><a href="Account.html">Account</a></li></ul><h3>Modules</h3><ul><li><a href="module-DisplayCard.html">DisplayCard</a></li><li><a href="module-LoadingScreen.html">LoadingScreen</a></li><li><a href="module-YourCards.html">YourCards</a></li></ul><h3>Classes</h3><ul><li><a href="BaseBackend.html">BaseBackend</a><ul class='methods'><li data-type='method'><a href="BaseBackend.html#dbAdd">dbAdd</a></li><li data-type='method'><a href="BaseBackend.html#dbAddEncrypted">dbAddEncrypted</a></li><li data-type='method'><a href="BaseBackend.html#dbDoesDocExist">dbDoesDocExist</a></li><li data-type='method'><a href="BaseBackend.html#dbGet">dbGet</a></li><li data-type='method'><a href="BaseBackend.html#dbGetEncrypted">dbGetEncrypted</a></li><li data-type='method'><a href="BaseBackend.html#dbGetSubCollections">dbGetSubCollections</a></li><li data-type='method'><a href="BaseBackend.html#dbSet">dbSet</a></li><li data-type='method'><a href="BaseBackend.html#dbSetEncrypted">dbSetEncrypted</a></li><li data-type='method'><a href="BaseBackend.html#doesSupportDatabase">doesSupportDatabase</a></li><li data-type='method'><a href="BaseBackend.html#enableDatabaseCaching">enableDatabaseCaching</a></li><li data-type='method'><a href="BaseBackend.html#getLoginProviders">getLoginProviders</a></li><li data-type='method'><a href="BaseBackend.html#getTimestamp">getTimestamp</a></li><li data-type='method'><a href="BaseBackend.html#getUserID">getUserID</a></li><li data-type='method'><a href="BaseBackend.html#getUserInfo">getUserInfo</a></li><li data-type='method'><a href="BaseBackend.html#initializeApp">initializeApp</a></li><li data-type='method'><a href="BaseBackend.html#onAuthStateChange">onAuthStateChange</a></li><li data-type='method'><a href="BaseBackend.html#resetPassword">resetPassword</a></li><li data-type='method'><a href="BaseBackend.html#setPrivateKey">setPrivateKey</a></li><li data-type='method'><a href="BaseBackend.html#signIn">signIn</a></li><li data-type='method'><a href="BaseBackend.html#signOut">signOut</a></li><li data-type='method'><a href="BaseBackend.html#signUp">signUp</a></li><li data-type='method'><a href="BaseBackend.html#userLoggedIn">userLoggedIn</a></li></ul></li><li><a href="FacebookLogin.html">FacebookLogin</a></li><li><a href="FirebaseBackend.html">FirebaseBackend</a><ul class='methods'><li data-type='method'><a href="FirebaseBackend.html#dbAdd">dbAdd</a></li><li data-type='method'><a href="FirebaseBackend.html#dbDelete">dbDelete</a></li><li data-type='method'><a href="FirebaseBackend.html#dbDoesDocExist">dbDoesDocExist</a></li><li data-type='method'><a href="FirebaseBackend.html#dbGet">dbGet</a></li><li data-type='method'><a href="FirebaseBackend.html#dbGetSubCollections">dbGetSubCollections</a></li><li data-type='method'><a href="FirebaseBackend.html#dbSet">dbSet</a></li><li data-type='method'><a href="FirebaseBackend.html#doesSupportDatabase">doesSupportDatabase</a></li><li data-type='method'><a href="FirebaseBackend.html#enableDatabaseCaching">enableDatabaseCaching</a></li><li data-type='method'><a href="FirebaseBackend.html#getLoginProviders">getLoginProviders</a></li><li data-type='method'><a href="FirebaseBackend.html#getTimestamp">getTimestamp</a></li><li data-type='method'><a href="FirebaseBackend.html#getUserID">getUserID</a></li><li data-type='method'><a href="FirebaseBackend.html#getUserInfo">getUserInfo</a></li><li data-type='method'><a href="FirebaseBackend.html#initializeApp">initializeApp</a></li><li data-type='method'><a href="FirebaseBackend.html#onAuthStateChange">onAuthStateChange</a></li><li data-type='method'><a href="FirebaseBackend.html#resetPassword">resetPassword</a></li><li data-type='method'><a href="FirebaseBackend.html#signIn">signIn</a></li><li data-type='method'><a href="FirebaseBackend.html#signOut">signOut</a></li><li data-type='method'><a href="FirebaseBackend.html#signUp">signUp</a></li><li data-type='method'><a href="FirebaseBackend.html#userLoggedIn">userLoggedIn</a></li></ul></li><li><a href="GoogleLogin.html">GoogleLogin</a></li><li><a href="LoginAuthorizer.html">LoginAuthorizer</a><ul class='methods'><li data-type='method'><a href="LoginAuthorizer.html#login">login</a></li></ul></li><li><a href="userClass.html">userClass</a><ul class='methods'><li data-type='method'><a href="userClass.html#addUser">addUser</a></li><li data-type='method'><a href="userClass.html#deleteCard">deleteCard</a></li><li data-type='method'><a href="userClass.html#getAllTransactions">getAllTransactions</a></li><li data-type='method'><a href="userClass.html#getCards">getCards</a></li><li data-type='method'><a href="userClass.html#getRewards">getRewards</a></li><li data-type='method'><a href="userClass.html#getTransactionsForCard">getTransactionsForCard</a></li><li data-type='method'><a href="userClass.html#getUserId">getUserId</a></li><li data-type='method'><a href="userClass.html#saveCardToUser">saveCardToUser</a></li><li data-type='method'><a href="userClass.html#saveTransactionToUser">saveTransactionToUser</a></li></ul></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">components/cards/DisplayCard.js</h1>
    

    <!--container.tmpl-->




    <!--source.tmpl-->

    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import React, { useState } from 'react';
import { Dimensions, View, Text, StyleSheet, Alert, TouchableOpacity, ScrollView, Modal, TextInput } from 'react-native';
import { cards } from '../../network/cards';
import { user } from '../../network/user';
import CachedImage from 'react-native-expo-cached-image';
import { Ionicons } from '@expo/vector-icons';
import { RewardModal } from './RewardModal';

/**
 * Display for a single credit card. Shows information about a card's rewards as well
 * as giving options to add a transaction to be associated with a its particular card.
 * 
 * @param {{Object, Object}} obj - The route and navigation passed directly to display card
 * @param {Object} obj.route - routing object containing information about a specific credit card
 * @param {Object} obj.navigation - navigation object used to move between different pages
 * @module DisplayCard
 */
function DisplayCard({route, navigation}) {
    const cardId = route.params.cardId;
    const docId = route.params.docId;
    const cardImage = route.params.img;
    const userId = user.getUserId();
    const [cardName, setCardName] = useState("");
    const storeInformation = route.params.storeInformation;
    const [displayTransactions, setDisplayTransactions] = useState(false);
    const [transactions, setTransactions] = useState([]);
    const [displayRewards, setDisplayRewards] = useState(false);
    const [rewards, setRewards] = useState([]);
    const [hasConstructed, setHasConstructed] = useState(false);
    const [showTransactionModal, setShowTransactionModal] = useState(false);
    const [transactionInput, setTransactionInput] = useState("");
    const rewardModal = React.createRef();
    console.log(rewardModal);

    // simulate constructor for functional components
    const constructor = () => { 
        if (hasConstructed) { 
            return;
        } else { 
            cards.getCardName(cardId).then((name) => { 
                setCardName(name);
            });
    
            user.getTransactionsForCard(userId, cardId, (data) => {
                setTransactions((transactions) => { 
                    const newTransactions = [...transactions, data];
                    return newTransactions;
                })
                    
                setDisplayTransactions(true);
            })

            user.getRewards(userId, cardId, (data) => { 
                setRewards(Object.entries(data));
                setDisplayRewards(true);
            })

            setHasConstructed(true);
        }
    }
    constructor();
    console.log("Testing")
    console.log(storeInformation);

    const confirmDelete = () => {
        Alert.alert(
            'Are you sure you would like to delete this card from your profile?',
            'please select one',
            [
              {text: 'NO', onPress: () => console.log(''), style: 'cancel'},
              {text: 'YES', onPress: () => deleteCard()},
            ]
          );
    };

    deleteCard = () => {
        user.deleteCard(userId, cardId, docId);
        navigation.navigate('YourCards');
    }

    addTransaction = () => {
        user.saveTransactionToUser(
            userId, 
            cardId, 
            {
                storeName: storeInformation["label"],
                address: storeInformation["vicinity"],
                storeType: storeInformation["storeType"]
            },
            transactionInput
        );

        setShowTransactionModal(false);

        setTransactions([]);
        user.getTransactionsForCard(userId, cardId, (data) => {
            setTransactions((transactions) => { 
                const newTransactions = [...transactions, data];
                return newTransactions;
            })
        })
    }

    addReward = () => { 
        console.log("adding reward");
    }

    showRewardModal = () => { 
        if (rewardModal) { 
            rewardModal.showModal();
        }
    }

    return (
        &lt;ScrollView 
            style={styles.container} 
            contentContainerStyle={styles.scrollviewContainer}
        >
            &lt;Modal
                transparent={true}
                backdropOpacity={0.3}
                visible={showTransactionModal}
            >
                &lt;View style={modalStyles.modalCenteredView}>
                    &lt;View style={modalStyles.modalView}>
                        &lt;View style={modalStyles.modalHeader}>
                            &lt;TouchableOpacity onPress={() => setShowTransactionModal(false)}>
                                &lt;Ionicons
                                    name="close-circle-outline"
                                    color="black"
                                    size={26}
                                >&lt;/Ionicons>
                            &lt;/TouchableOpacity>
                        &lt;/View>
                        &lt;Text style={modalStyles.modalText}>Adding a transaction at&lt;/Text>
                        &lt;Text style={modalStyles.storeText}>{storeInformation ? storeInformation.value : "" }&lt;/Text>
                        &lt;Text style={modalStyles.modalText}>How much did you spend?&lt;/Text>
                        &lt;TextInput
                            style={modalStyles.manualTextInput}
                            onChangeText={(text) => setTransactionInput(text)}
                            value={transactionInput}
                            placeholder={"amount in dollars"}
                            onSubmitEditing={addTransaction}
                        />
                    &lt;/View>
                &lt;/View>
            &lt;/Modal>

            {/* TODO: Add this in beta version */}
            {/* &lt;RewardModal ref={rewardModal}>&lt;/RewardModal> */}
            
            &lt;View style={{justifyContent: 'flex-start'}}>
                &lt;Text style={styles.cardTitle}>{cardName}&lt;/Text>
                &lt;CachedImage
                    source={cardImage}
                    style={styles.card}
                />

                {/* TODO maybe these sections should be collapsible? */}
                &lt;Text style={styles.sectionTitle}>Transactions&lt;/Text> 
                {
                    displayTransactions &amp;&amp;
                    &lt;View>
                        {
                            transactions.map((transaction, i) => {
                                var date = transaction.dateAdded.toDate().toDateString();
                                var name = transaction.storeInfo.storeName;
                                var dollarAmount = transaction.amountSpent;
                                return (
                                    // TODO each row should be swipeable -> delete
                                    &lt;View style={styles.sectionText} key={i}>
                                        &lt;Text style={{fontWeight : 'bold'}}>{date}&lt;/Text>
                                        &lt;Text style={{marginLeft: 5}}>{name}: ${dollarAmount}&lt;/Text>
                                    &lt;/View>
                                )
                            })
                        }
                    &lt;/View>
                }
                &lt;TouchableOpacity style={styles.addTransactionButton} onPress={() => setShowTransactionModal(true)}>
                    &lt;Text>Add a transaction&lt;/Text>
                &lt;/TouchableOpacity>

                &lt;Text style={styles.sectionTitle}>Rewards&lt;/Text>
                {
                    displayRewards &amp;&amp; 
                    rewards.map((reward, i) => {
                        var category = reward[0];
                        var amountCents = reward[1]; 
                        return (
                            &lt;View style={styles.sectionText} key={i}>
                                &lt;Text style={{ fontWeight: 'bold' }}>{category}&lt;/Text>
                                &lt;Text style={{ marginLeft: 5 }}>{amountCents} cents&lt;/Text>
                            &lt;/View>
                        )
                    })
                }
                &lt;TouchableOpacity style={styles.addTransactionButton} onPress={showRewardModal}>
                    &lt;Text style={{}}>Add a reward&lt;/Text>
                &lt;/TouchableOpacity>
            &lt;/View>

            &lt;TouchableOpacity style={styles.deleteContainer} onPress={confirmDelete}> 
                &lt;Text style={styles.deleteText}>Delete this card&lt;/Text>
            &lt;/TouchableOpacity>
        &lt;/ScrollView>
    )
}

const styles = StyleSheet.create({
    container: {
        backgroundColor: 'white',
        height: '100%', 
        // justifyContent: 'space-between',
        flex: 1
    },
    scrollviewContainer: { 
        justifyContent: 'space-between',
        flexGrow: 1
    },
    cardTitle: { 
        textAlign: 'center',
        marginTop: 25,
        fontSize: 24
    },
    card: {
        width: Dimensions.get('window').width * .9,  //its same to '20%' of device width
        aspectRatio: 1.5, // &lt;-- this
        resizeMode: "contain",
        height: 230, // hard coded for now
        marginBottom: 10,
        alignSelf: 'center'
    }, 
    sectionTitle: {
        padding: 10,
        fontSize: 16,
        backgroundColor: '#28b573',
        color: 'white'
    },
    sectionText: {
        display: 'flex',
        width: '100%',
        height: 35,
        flexDirection: 'row',
        justifyContent: 'center',
        alignItems: 'center',
        borderBottomColor: 'lightgray',
        borderBottomWidth: 1
    },
    addTransactionButton: {
        display: 'flex',
        width: '100%',
        height: 35,
        flexDirection: 'row',
        justifyContent: 'center',
        alignItems: 'center',
        borderBottomColor: 'lightgray',
        borderBottomWidth: 1,
        backgroundColor: '#f5f5f5'
    },
    deleteContainer: { 
        alignItems: 'center',
        marginBottom: 10,
        marginTop: 10
    },
    deleteText: {
        fontSize: 16,
        color: 'red',
    }
});

const modalStyles = StyleSheet.create({
    modalCenteredView: {
        flex: 1,
        justifyContent: 'center',
        alignItems: 'stretch',
        marginTop: 22,
        padding: 22,
        backgroundColor: 'rgba(128, 128, 128, 0.5)'
    },
    modalView: {
        backgroundColor: 'white',
        justifyContent: 'center',
        alignItems: 'stretch',
        borderRadius: 4,
        borderColor: 'rgba(0, 0, 0, 0.1)',
    },
    modalHeader: { 
        position: 'absolute',
        top: 8, 
        left: 8
    },
    modalText: {
        marginTop: 10,
        alignSelf: 'center',
        fontSize: 16
    },
    storeText: {
        alignSelf: 'center',
        fontWeight: 'bold',
        fontSize: 16,
        marginBottom: 10
    },
    manualTextInput: {
        height: 40,
        borderWidth: 1,
        margin: 15,
        marginTop: 7,
        marginBottom: 7,
        width: '90%',
        borderColor: '#F0F0F0',
        backgroundColor: '#F0F0F0',
        borderRadius: 5,
    },
});

export {DisplayCard};</code></pre>
        </article>
    </section>





</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.6</a> on Sun Mar 07 2021 11:11:43 GMT-0800 (Pacific Standard Time) using the LOKE theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
