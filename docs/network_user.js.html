<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Adding meta -->
    

    <!-- Adding external script-->
    

    <!-- Adding external style-->
    

    <!-- Adding scripts-->
    

    <!-- Adding style-->
    

    <!-- Adding overlay script-->
    

    <!-- Adding overlay style-->
    


    <title>network/user.js</title>

    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/third-party/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/third-party/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
    <link type="text/css" rel="stylesheet" href="styles/clean-jsdoc-theme-base.css">
    <link type="text/css" rel="stylesheet" href="styles/clean-jsdoc-theme-light.css">
    
<svg aria-hidden="true" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="display:none">
    <defs>
        <symbol id="copy-icon" viewbox="0 0 488.3 488.3">
            <g>
                <path d="M314.25,85.4h-227c-21.3,0-38.6,17.3-38.6,38.6v325.7c0,21.3,17.3,38.6,38.6,38.6h227c21.3,0,38.6-17.3,38.6-38.6V124    C352.75,102.7,335.45,85.4,314.25,85.4z M325.75,449.6c0,6.4-5.2,11.6-11.6,11.6h-227c-6.4,0-11.6-5.2-11.6-11.6V124    c0-6.4,5.2-11.6,11.6-11.6h227c6.4,0,11.6,5.2,11.6,11.6V449.6z"/>
                <path d="M401.05,0h-227c-21.3,0-38.6,17.3-38.6,38.6c0,7.5,6,13.5,13.5,13.5s13.5-6,13.5-13.5c0-6.4,5.2-11.6,11.6-11.6h227    c6.4,0,11.6,5.2,11.6,11.6v325.7c0,6.4-5.2,11.6-11.6,11.6c-7.5,0-13.5,6-13.5,13.5s6,13.5,13.5,13.5c21.3,0,38.6-17.3,38.6-38.6    V38.6C439.65,17.3,422.35,0,401.05,0z"/>
            </g>
        </symbol>
    </defs>
</svg>

</head>
<body>
<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html"><div class="text">Home</div></a></h2><div class="search-box"><input type="text" placeholder="Search..." id="search-box" /><div class="search-item-container" id="search-item-container"><ul class="search-item-ul" id="search-item-ul"></ul></div></div><div class="sidebar-list-div"><h3>Classes</h3><ul><li class="accordion collapsed" id=9605654><div class="accordion-title"><a href="BaseBackend.html">BaseBackend</a><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" width="16" height="16">
    <path 
        fill-rule="evenodd" 
        clip-rule="evenodd" 
        d="M12.7803 6.21967C13.0732 6.51256 13.0732 6.98744 12.7803 7.28033L8.53033 11.5303C8.23744 11.8232 7.76256 11.8232 7.46967 11.5303L3.21967 7.28033C2.92678 6.98744 2.92678 6.51256 3.21967 6.21967C3.51256 5.92678 3.98744 5.92678 4.28033 6.21967L8 9.93934L11.7197 6.21967C12.0126 5.92678 12.4874 5.92678 12.7803 6.21967Z">
    </path>
</svg></div><ul class='methods accordion-content'><li data-type='method'><a href="BaseBackend.html#dbAdd">dbAdd</a></li><li data-type='method'><a href="BaseBackend.html#dbAddEncrypted">dbAddEncrypted</a></li><li data-type='method'><a href="BaseBackend.html#dbGet">dbGet</a></li><li data-type='method'><a href="BaseBackend.html#dbGetEncrypted">dbGetEncrypted</a></li><li data-type='method'><a href="BaseBackend.html#dbGetSubCollections">dbGetSubCollections</a></li><li data-type='method'><a href="BaseBackend.html#dbSet">dbSet</a></li><li data-type='method'><a href="BaseBackend.html#dbSetEncrypted">dbSetEncrypted</a></li><li data-type='method'><a href="BaseBackend.html#doesSupportDatabase">doesSupportDatabase</a></li><li data-type='method'><a href="BaseBackend.html#enableDatabaseCaching">enableDatabaseCaching</a></li><li data-type='method'><a href="BaseBackend.html#getUserID">getUserID</a></li><li data-type='method'><a href="BaseBackend.html#initializeApp">initializeApp</a></li><li data-type='method'><a href="BaseBackend.html#onAuthStateChange">onAuthStateChange</a></li><li data-type='method'><a href="BaseBackend.html#resetPassword">resetPassword</a></li><li data-type='method'><a href="BaseBackend.html#setPrivateKey">setPrivateKey</a></li><li data-type='method'><a href="BaseBackend.html#signIn">signIn</a></li><li data-type='method'><a href="BaseBackend.html#signInWithFacebook">signInWithFacebook</a></li><li data-type='method'><a href="BaseBackend.html#signInWithGoogle">signInWithGoogle</a></li><li data-type='method'><a href="BaseBackend.html#signOut">signOut</a></li><li data-type='method'><a href="BaseBackend.html#signUp">signUp</a></li><li data-type='method'><a href="BaseBackend.html#userLoggedIn">userLoggedIn</a></li></ul></li><li class="accordion collapsed" id=9644652><div class="accordion-title"><a href="FirebaseBackend.html">FirebaseBackend</a><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" width="16" height="16">
    <path 
        fill-rule="evenodd" 
        clip-rule="evenodd" 
        d="M12.7803 6.21967C13.0732 6.51256 13.0732 6.98744 12.7803 7.28033L8.53033 11.5303C8.23744 11.8232 7.76256 11.8232 7.46967 11.5303L3.21967 7.28033C2.92678 6.98744 2.92678 6.51256 3.21967 6.21967C3.51256 5.92678 3.98744 5.92678 4.28033 6.21967L8 9.93934L11.7197 6.21967C12.0126 5.92678 12.4874 5.92678 12.7803 6.21967Z">
    </path>
</svg></div><ul class='methods accordion-content'><li data-type='method'><a href="FirebaseBackend.html#dbAdd">dbAdd</a></li><li data-type='method'><a href="FirebaseBackend.html#dbDoesDocExist">dbDoesDocExist</a></li><li data-type='method'><a href="FirebaseBackend.html#dbGet">dbGet</a></li><li data-type='method'><a href="FirebaseBackend.html#dbGetSubCollections">dbGetSubCollections</a></li><li data-type='method'><a href="FirebaseBackend.html#dbSet">dbSet</a></li><li data-type='method'><a href="FirebaseBackend.html#doesSupportDatabase">doesSupportDatabase</a></li><li data-type='method'><a href="FirebaseBackend.html#enableDatabaseCaching">enableDatabaseCaching</a></li><li data-type='method'><a href="FirebaseBackend.html#getUserID">getUserID</a></li><li data-type='method'><a href="FirebaseBackend.html#initializeApp">initializeApp</a></li><li data-type='method'><a href="FirebaseBackend.html#onAuthStateChange">onAuthStateChange</a></li><li data-type='method'><a href="FirebaseBackend.html#resetPassword">resetPassword</a></li><li data-type='method'><a href="FirebaseBackend.html#signIn">signIn</a></li><li data-type='method'><a href="FirebaseBackend.html#signOut">signOut</a></li><li data-type='method'><a href="FirebaseBackend.html#signUp">signUp</a></li><li data-type='method'><a href="FirebaseBackend.html#userLoggedIn">userLoggedIn</a></li></ul></li><li class="accordion collapsed" id=5624859><div class="accordion-title"><a href="userClass.html">userClass</a><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" width="16" height="16">
    <path 
        fill-rule="evenodd" 
        clip-rule="evenodd" 
        d="M12.7803 6.21967C13.0732 6.51256 13.0732 6.98744 12.7803 7.28033L8.53033 11.5303C8.23744 11.8232 7.76256 11.8232 7.46967 11.5303L3.21967 7.28033C2.92678 6.98744 2.92678 6.51256 3.21967 6.21967C3.51256 5.92678 3.98744 5.92678 4.28033 6.21967L8 9.93934L11.7197 6.21967C12.0126 5.92678 12.4874 5.92678 12.7803 6.21967Z">
    </path>
</svg></div><ul class='methods accordion-content'><li data-type='method'><a href="userClass.html#addUser">addUser</a></li><li data-type='method'><a href="userClass.html#deleteCard">deleteCard</a></li><li data-type='method'><a href="userClass.html#getAllTransactions">getAllTransactions</a></li><li data-type='method'><a href="userClass.html#getCards">getCards</a></li><li data-type='method'><a href="userClass.html#getRewards">getRewards</a></li><li data-type='method'><a href="userClass.html#getTransactionsForCard">getTransactionsForCard</a></li><li data-type='method'><a href="userClass.html#getUserId">getUserId</a></li><li data-type='method'><a href="userClass.html#saveCardToUser">saveCardToUser</a></li><li data-type='method'><a href="userClass.html#saveTransactionToUser">saveTransactionToUser</a></li></ul></li></ul><h3><a href="global.html">Global</a></h3><ul><li><a href="global.html#appBackend">appBackend</a></li><li><a href="global.html#CardImage">CardImage</a></li><li><a href="global.html#contrastRGB">contrastRGB</a></li><li><a href="global.html#generateColor">generateColor</a></li><li><a href="global.html#grayRGB">grayRGB</a></li><li><a href="global.html#initializeAppBackend">initializeAppBackend</a></li></ul></div>
</nav>

<div id="main">
    
    <h1 id='page-title' class="page-title">network/user.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import { appBackend } from './backend';

/**
 * A user class that peforms user database options
 */
class userClass { 
    /**
     * Checks if the user is currently in the "users" database. If not  
     * in the database, registers the user. Returns the user id
     */
    getUserId() { 
        var userId = appBackend.getUserID(); 
        if (userId == null) { 
            // user is not using a login, store all data locally?
            userId = "test"; // TODO test is temporary
        } else {
            appBackend.dbDoesDocExist("users." + userId, (docExists) => {
                if (!docExists) {
                    this.addUser(userId);
                }
            });
        }
        return userId;
    }

    /**
     * Adds a user to the card database with inital date added
     * 
     * @param {String} userId - the user's id after logged in 
     */
    addUser(userId) { 
        var date = new Date();

        appBackend.dbSet("users." + userId, { 
            dateCreated: date
            // TODO: maybe add name and email here?
        }, (id) => { 
            console.log(id);
        });
    }

    /**
     * Gets the cards associated with a user id
     * @param {string} userId - The User Id
     */
    async getCards(userId) { 
        return new Promise((resolve, reject) => { 
            appBackend.dbGetSubCollections("users." + userId + ".cards", (data) => {
                resolve(data);
            })
        })
    }

    /**
     *  Deletes a card from the user's database 
     * @param {*} userId - current user id
     * @param {*} cardId - card id they want to delete
     */
    deleteCard(userId, cardId) { 
        appBackend.dbDelete("users." + userId + ".cards." + cardId);
    }

    /** 
     * 
     *
     */ 
    saveCardToUser(userId, cardId, transactions, diff) { 
        appBackend.dbAdd("users." + userId + ".cards", {
            cardId: cardId, 
            transactions: transactions,
            diff: diff
        }, (id) => { 
            console.log("successfully saved card to user");
        })
    }

    updateUserCard(cardId, amountSpent, diff) { 
        // TODO
    }

    /**
     * Add a transaction to user's transaction collection
     * @param {*} userId - current user id
     * @param {*} cardId - card id they want to delete
     * @param {*} storeInfo - store information (store name, address, category)
     * @param {*} amountSpent - amount spent at the store
     */
    saveTransactionToUser(userId, cardId, storeInfo, amountSpent) {
        timestamp = appBackend.getTimestamp();
        console.log("saving transactions");
        console.log("user id " + userId + "\n card id " + cardId + "\n store info " + storeInfo + "\n amountSpent " + amountSpent);
        appBackend.dbAdd("users." + userId + ".transactions", {
            cardId: cardId,
            storeInfo: {
                storeName: storeInfo["storeName"],
                address: storeInfo["address"],
                storeType: storeInfo["storeType"]
            },
            amountSpent: amountSpent,
            dateAdded: timestamp
        }, (id) => { 
            console.log("successfully saved transaction to user");
        })
    }

    /**
     * Gets all of a user's transactions
     * @param {string} userId - the user whose transactions to grab
     * 
     * @example
     *  user.getTransactions(userId, (data) => { 
     *      console.log(data);
     *      setTransactions(data);
     *      setDisplayTransactions(true);
     *  })
     */
    getAllTransactions(userId, callback) { 
        appBackend.dbGetSubCollections("users." + userId + ".transactions", (data) => { 
            callback(data);
        })
    }

    /**
     * Gets transactions for a user's card
     * @param {string} userId - user id of transactions to get
     * @param {string} cardId  - card id of card to get
     * @param {string} callback  - callback function to apply to each transaction object
     * 
     * @example
     *  user.getTransactionsForCard(userId, cardId, (data) => {
     *      setTransactions((transactions) => { 
     *      const newTransactions = [...transactions, data];
     *      return newTransactions;
     *  })
     */
    getTransactionsForCard(userId, cardId, callback) { 
        appBackend.dbGet("users." + userId + ".transactions", ["cardId", "==", cardId], (data) => { 
            callback(data);
        })
    }

    /**
     * Gets a user's rewards. In user backend because user diff is need to apply 
     * to card rewards
     * @param {*} userId - user id of diff to get
     * @param {*} cardId - card id of card rewards to get
     * @param {*} callback - callback function to apply to resultant data
     * 
     * @example
     * TODO
     */
    getRewards(userId, cardId, callback) {
        console.log("getting a user's rewards");
        appBackend.dbGet("cards." + cardId, (data)=> { 
            // TODO apply diff
            callback(data.rewards);
        })
    }
}

export var user = new userClass();</code></pre>
        </article>
    </section>




</div>

<footer id="footer">
  
</footer>

<script src="scripts/third-party/prettify.js"></script>
<script src="scripts/third-party/lang-css.js"></script>
<script src="scripts/search.js"></script>
<script src="scripts/third-party/fuse.js"></script>
<script type="text/javascript" src="scripts/misc.js"></script>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
<script src="scripts/fix-code-block.js"></script>
<script>
  var list = [{"title":"BaseBackend","link":"<a href=\"BaseBackend.html\">BaseBackend</a>"},{"title":"BaseBackend#dbAdd","link":"<a href=\"BaseBackend.html#dbAdd\">BaseBackend &rtrif; dbAdd</a>"},{"title":"BaseBackend#dbAddEncrypted","link":"<a href=\"BaseBackend.html#dbAddEncrypted\">BaseBackend &rtrif; dbAddEncrypted</a>"},{"title":"BaseBackend#dbGet","link":"<a href=\"BaseBackend.html#dbGet\">BaseBackend &rtrif; dbGet</a>"},{"title":"BaseBackend#dbGetEncrypted","link":"<a href=\"BaseBackend.html#dbGetEncrypted\">BaseBackend &rtrif; dbGetEncrypted</a>"},{"title":"BaseBackend#dbGetSubCollections","link":"<a href=\"BaseBackend.html#dbGetSubCollections\">BaseBackend &rtrif; dbGetSubCollections</a>"},{"title":"BaseBackend#dbSet","link":"<a href=\"BaseBackend.html#dbSet\">BaseBackend &rtrif; dbSet</a>"},{"title":"BaseBackend#dbSetEncrypted","link":"<a href=\"BaseBackend.html#dbSetEncrypted\">BaseBackend &rtrif; dbSetEncrypted</a>"},{"title":"BaseBackend#doesSupportDatabase","link":"<a href=\"BaseBackend.html#doesSupportDatabase\">BaseBackend &rtrif; doesSupportDatabase</a>"},{"title":"BaseBackend#enableDatabaseCaching","link":"<a href=\"BaseBackend.html#enableDatabaseCaching\">BaseBackend &rtrif; enableDatabaseCaching</a>"},{"title":"BaseBackend#getUserID","link":"<a href=\"BaseBackend.html#getUserID\">BaseBackend &rtrif; getUserID</a>"},{"title":"BaseBackend#initializeApp","link":"<a href=\"BaseBackend.html#initializeApp\">BaseBackend &rtrif; initializeApp</a>"},{"title":"BaseBackend#onAuthStateChange","link":"<a href=\"BaseBackend.html#onAuthStateChange\">BaseBackend &rtrif; onAuthStateChange</a>"},{"title":"BaseBackend#resetPassword","link":"<a href=\"BaseBackend.html#resetPassword\">BaseBackend &rtrif; resetPassword</a>"},{"title":"BaseBackend#setPrivateKey","link":"<a href=\"BaseBackend.html#setPrivateKey\">BaseBackend &rtrif; setPrivateKey</a>"},{"title":"BaseBackend#signIn","link":"<a href=\"BaseBackend.html#signIn\">BaseBackend &rtrif; signIn</a>"},{"title":"BaseBackend#signInWithFacebook","link":"<a href=\"BaseBackend.html#signInWithFacebook\">BaseBackend &rtrif; signInWithFacebook</a>"},{"title":"BaseBackend#signInWithGoogle","link":"<a href=\"BaseBackend.html#signInWithGoogle\">BaseBackend &rtrif; signInWithGoogle</a>"},{"title":"BaseBackend#signOut","link":"<a href=\"BaseBackend.html#signOut\">BaseBackend &rtrif; signOut</a>"},{"title":"BaseBackend#signUp","link":"<a href=\"BaseBackend.html#signUp\">BaseBackend &rtrif; signUp</a>"},{"title":"BaseBackend#userLoggedIn","link":"<a href=\"BaseBackend.html#userLoggedIn\">BaseBackend &rtrif; userLoggedIn</a>"},{"title":"FirebaseBackend","link":"<a href=\"FirebaseBackend.html\">FirebaseBackend</a>"},{"title":"FirebaseBackend#dbAdd","link":"<a href=\"FirebaseBackend.html#dbAdd\">FirebaseBackend &rtrif; dbAdd</a>"},{"title":"FirebaseBackend#dbDoesDocExist","link":"<a href=\"FirebaseBackend.html#dbDoesDocExist\">FirebaseBackend &rtrif; dbDoesDocExist</a>"},{"title":"FirebaseBackend#dbGet","link":"<a href=\"FirebaseBackend.html#dbGet\">FirebaseBackend &rtrif; dbGet</a>"},{"title":"FirebaseBackend#dbGetSubCollections","link":"<a href=\"FirebaseBackend.html#dbGetSubCollections\">FirebaseBackend &rtrif; dbGetSubCollections</a>"},{"title":"FirebaseBackend#dbSet","link":"<a href=\"FirebaseBackend.html#dbSet\">FirebaseBackend &rtrif; dbSet</a>"},{"title":"FirebaseBackend#doesSupportDatabase","link":"<a href=\"FirebaseBackend.html#doesSupportDatabase\">FirebaseBackend &rtrif; doesSupportDatabase</a>"},{"title":"FirebaseBackend#enableDatabaseCaching","link":"<a href=\"FirebaseBackend.html#enableDatabaseCaching\">FirebaseBackend &rtrif; enableDatabaseCaching</a>"},{"title":"FirebaseBackend#getUserID","link":"<a href=\"FirebaseBackend.html#getUserID\">FirebaseBackend &rtrif; getUserID</a>"},{"title":"FirebaseBackend#initializeApp","link":"<a href=\"FirebaseBackend.html#initializeApp\">FirebaseBackend &rtrif; initializeApp</a>"},{"title":"FirebaseBackend#onAuthStateChange","link":"<a href=\"FirebaseBackend.html#onAuthStateChange\">FirebaseBackend &rtrif; onAuthStateChange</a>"},{"title":"FirebaseBackend#resetPassword","link":"<a href=\"FirebaseBackend.html#resetPassword\">FirebaseBackend &rtrif; resetPassword</a>"},{"title":"FirebaseBackend#signIn","link":"<a href=\"FirebaseBackend.html#signIn\">FirebaseBackend &rtrif; signIn</a>"},{"title":"FirebaseBackend#signOut","link":"<a href=\"FirebaseBackend.html#signOut\">FirebaseBackend &rtrif; signOut</a>"},{"title":"FirebaseBackend#signUp","link":"<a href=\"FirebaseBackend.html#signUp\">FirebaseBackend &rtrif; signUp</a>"},{"title":"FirebaseBackend#userLoggedIn","link":"<a href=\"FirebaseBackend.html#userLoggedIn\">FirebaseBackend &rtrif; userLoggedIn</a>"},{"title":"userClass","link":"<a href=\"userClass.html\">userClass</a>"},{"title":"userClass#addUser","link":"<a href=\"userClass.html#addUser\">userClass &rtrif; addUser</a>"},{"title":"userClass#deleteCard","link":"<a href=\"userClass.html#deleteCard\">userClass &rtrif; deleteCard</a>"},{"title":"userClass#getAllTransactions","link":"<a href=\"userClass.html#getAllTransactions\">userClass &rtrif; getAllTransactions</a>"},{"title":"userClass#getCards","link":"<a href=\"userClass.html#getCards\">userClass &rtrif; getCards</a>"},{"title":"userClass#getRewards","link":"<a href=\"userClass.html#getRewards\">userClass &rtrif; getRewards</a>"},{"title":"userClass#getTransactionsForCard","link":"<a href=\"userClass.html#getTransactionsForCard\">userClass &rtrif; getTransactionsForCard</a>"},{"title":"userClass#getUserId","link":"<a href=\"userClass.html#getUserId\">userClass &rtrif; getUserId</a>"},{"title":"userClass#saveCardToUser","link":"<a href=\"userClass.html#saveCardToUser\">userClass &rtrif; saveCardToUser</a>"},{"title":"userClass#saveTransactionToUser","link":"<a href=\"userClass.html#saveTransactionToUser\">userClass &rtrif; saveTransactionToUser</a>"},{"title":"appBackend","link":"<a href=\"global.html#appBackend\">Global &rtrif; appBackend</a>"},{"title":"CardImage","link":"<a href=\"global.html#CardImage\">Global &rtrif; CardImage</a>"},{"title":"contrastRGB","link":"<a href=\"global.html#contrastRGB\">Global &rtrif; contrastRGB</a>"},{"title":"generateColor","link":"<a href=\"global.html#generateColor\">Global &rtrif; generateColor</a>"},{"title":"grayRGB","link":"<a href=\"global.html#grayRGB\">Global &rtrif; grayRGB</a>"},{"title":"initializeAppBackend","link":"<a href=\"global.html#initializeAppBackend\">Global &rtrif; initializeAppBackend</a>"}];
  var options = 
  setupSearch(list, options)
</script>

 






</body>
</html>
